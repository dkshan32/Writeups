---
cover: >-
  https://images.unsplash.com/photo-1541728472741-03e45a58cf88?crop=entropy&cs=srgb&fm=jpg&ixid=MnwxOTcwMjR8MHwxfHNlYXJjaHw5fHxoYWNrZXJ8ZW58MHx8fHwxNjQ0OTUxOTI2&ixlib=rb-1.2.1&q=85
coverY: 421.77650429799417
description: Isolated - Connected only to the other Windows machine!
---

# ðŸ”° 10.200.81.100 | Windows

* [ ] VPN
* [ ] `sshuttle`
* [ ] `evil-winrm` session --> Chisel server
* [ ] Chisel client
* [ ] Foxyproxy socks5 - switch proxy
* [ ] Explore `/.git/` and exploit

## <mark style="color:purple;background-color:green;">\_\_Enumeration\_\_</mark>

<details>

<summary><mark style="color:purple;">NMAP</mark></summary>

```
-------------FROM LINUX HOST---------------
Host is up (-0.20s latency).
All 6150 scanned ports on ip-10-200-81-100.eu-west-1.compute.internal (10.200.81.100) are filtered
MAC Address: 02:0C:B8:82:73:37 (Unknown)
```

```
-------------FROM WINDOWS HOST---------------
Hostname          OpenPorts
--------          ---------
10.200.81.100     80,3389
```

</details>

<details>

<summary><mark style="color:green;">Web Services</mark></summary>

**Technologies**

![](<../../.gitbook/assets/image (5).png>)\
Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.11 Server at 10.200.81.100 Port 80

**Dirsearch | Gobuster**

```yaml
/.git/
```

#### Page Screenshots

![](<../../.gitbook/assets/image (11).png>)

</details>

## <mark style="color:red;background-color:yellow;">\_\_Exploitation\_\_</mark>

### _<mark style="color:orange;">FOOTHOLD</mark>_

* Two ways - Use GitTools over the socks5 proxy (_VERY SLOW_)
* OR, We already have persistent access to Git-Serv, find the .git folder, download and dump the contents locally.

### Finding and dumping the Source Code from `Git-Serv` for the Development Server

![](<../../.gitbook/assets/image (21).png>)![](<../../.gitbook/assets/image (22).png>)\
Download it using the `download <path>` feature. Do specify the absolute path to the <mark style="color:blue;">Website.git</mark> directory!\
![](<../../.gitbook/assets/image (7).png>)\
![](<../../.gitbook/assets/image (18).png>)\
Checking out the <mark style="color:red;">latest commit</mark>, we see an **upload functionality** at `resources/index.php`

```php
<?php
        if(isset($_POST["upload"]) && is_uploaded_file($_FILES["file"]["tmp_name"])){
                $target = "uploads/".basename($_FILES["file"]["name"]);
                $goodExts = ["jpg", "jpeg", "png", "gif"];
                if(file_exists($target)){
                        header("location: ./?msg=Exists");
                        die();
                }
                $size = getimagesize($_FILES["file"]["tmp_name"]);
                if(!in_array(explode(".", $_FILES["file"]["name"])[1], $goodExts) || !$size){
                        header("location: ./?msg=Fail");
                        die();
                }
                move_uploaded_file($_FILES["file"]["tmp_name"], $target);
                header("location: ./?msg=Success");
                die();
        } else if ($_SERVER["REQUEST_METHOD"] == "post"){
                header("location: ./?msg=Method");
        }


        if(isset($_GET["msg"])){
                $msg = $_GET["msg"];
                switch ($msg) {
                        case "Success":
                                $res = "File uploaded successfully!";
                                break;
                        case "Fail":
                                $res = "Invalid File Type";
                                break;
                        case "Exists":
                                $res = "File already exists";
                                break;
                        case "Method":
                                $res = "No file send";
                                break;

                }
        }
?>
<!DOCTYPE html>
<html lang=en>
        <!-- ToDo:
                  - Finish the styling: it looks awful
                  - Get Ruby more food. Greedy animal is going through it too fast
                  - Upgrade the filter on this page. Can't rely on basic auth for everything
                  - Phone Mrs Walker about the neighbourhood watch meetings
        -->
        <head>
                <title>Ruby Pictures</title>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link rel="stylesheet" type="text/css" href="assets/css/Andika.css">
                <link rel="stylesheet" type="text/css" href="assets/css/styles.css">
        </head>
        <body>
                <main>
                        <h1>Welcome Thomas!</h1>
                        <h2>Ruby Image Upload Page</h2>
                        <form method="post" enctype="multipart/form-data">
                                <input type="file" name="file" id="fileEntry" required, accept="image/jpeg,image/png,image/gif">
                                <input type="submit" name="upload" id="fileSubmit" value="Upload">
                        </form>
                        <p id=res><?php if (isset($res)){ echo $res; };?></p>
                </main>
        </body>
</html>
```

### Code Review





Going to /resources - Auth required!

![](<../../.gitbook/assets/image (6).png>)

In the `apache/conf/` directory, we see many directories in which every Authentication is done using the `C:/GitStack/data/passwdfile` which we discovered previously.\
![](<../../.gitbook/assets/image (9).png>)\
So the user and password to login --> **`twreath`** or **`Thomas : i<3ruby` **&#x20;

### _<mark style="color:red;">USER</mark>_

\


### _<mark style="color:red;">PRIV-ESC</mark>_

__\
__

__
